//devin87@qq.com
//build:2015/12/02 13:19:07
!function(e){"use strict";function t(t,i,n){i!=e&&(t.style.left=i+"px"),n!=e&&(t.style.top=n+"px")}function i(e,t){this.set(t).init(e)}var n=window.document,s=Q.fire,r=Q.extend,o=Q.makeArray,a=Q.getStyle,u=Q.offset,d=Q.hasClass,f=Q.addClass,h=Q.removeClass,c=Q.createEle,_=Q.factory,m=Q.event,l=-1e4;_(i).extend({init:function(e){var t=this;return t.draw(e),t.autoHide!==!1&&(t._e0=m.add(n,"click",function(){t.hide()})),t},set:function(e){return r(this,e,!0),this},draw:function(t){var i=this;i._menus=[],i._items=[],i._map_menu={},i._map_item={},i.i=i.j=0,i._active=e;var n,r=i._tmp=[];for(i.drawMenu(t);n=r.shift();)i.drawMenu.apply(i,n);i._tmp=null,i.i=i.j=0;var o=i._getMenu(0).node;i.box=o;var a=[];return i._menus.forEach(function(e){e&&!e.linked&&a.push(e.node)}),i._e1&&i._e1.off(),i._e1=m.add(a,{click:function(e){var t=this,n=t._j;if(d(t,"x-disabled")||i._getSubMenu(n)&&!i.isFireAll)return!1;var r=i._getItem(n);s(r.data.click,t,e,r),s(i.onclick,t,e,r),i.hide()},mouseenter:function(e){var t=this,n=t._i,r=t._j;i._hideSub(n,r),f(t,"x-on");var o=i._getItem(r);s(o.data.mouseover,t,e,o),s(i.onmouseover,t,e,o),d(t,"x-disabled")||i._showSub(n,r,t)},mouseleave:function(e){var t=this,n=t._i,r=t._j,o=i._getSubMenu(r);d(t,"x-disabled")||!o?h(t,"x-on"):0==n&&(i._active=r);var a=i._getItem(r);s(a.data.mouseout,t,e,a),s(i.onmouseout,t,e,a)}},".x-item"),i._e2&&i._e2.off(),i._e2=m.add(a,"mousedown",m.stop),i.hide()},drawMenu:function(t,i){var s=this,r=s._menus,o=s._items,a=s._map_menu,u=s._map_item,d=t.box,f=!!d,h=s.i++;if(!d){var _=t.className,d=c("div","x-panel"+(_?" "+_:""));d.style.width=(t.width||120)+"px"}if(r[h]={node:d,linked:f,j:i,data:t},i&&(a[i]=h),f)return s;for(var m=s.subMenu!==!1,l=0,v=t.items;l<v.length;l++){var x=v[l];if(x){var p=n.createElement("div"),g=s.j++;if(p._i=h,p._j=g,o[g]={node:p,i:h,j:g,data:x},x.id!=e&&(u[x.id]=g),x.split)p.className="x-split";else{p.className="x-item"+(x.disabled?" x-disabled":""),p.x=x.x!=e?x.x:"";var b=x.group,I=m&&b&&(b.box||b.items&&b.items.length>0),M=x.ico,w=x.html||'<div class="x-icon">'+(M?/^<.+>$/.test(M)?M:'<img alt="" src="'+M+'">':"")+'</div><div class="x-text"'+(x.title?' title="'+x.title+'"':"")+">"+x.text+"</div>"+(I?'<div class="arrow"></div>':"");p.innerHTML=w,I&&s._tmp.push([b,g])}d.appendChild(p)}}return Q.body.appendChild(d),s},_getMenu:function(e){return this._menus[e]},_getSubMenu:function(t){var i=this._map_menu[t];return i!=e?this._getMenu(i):e},_getItem:function(e){return this._items[e]},getItem:function(t){var i=this._map_item[t];return i!=e?this._items[i]:e},setItemText:function(e,t){var i=this.getItem(e);if(i){i.data.text=t;var n=i.node.childNodes[1];n&&(n.innerHTML=t)}},processItems:function(e,t){var i=this;return o(e).forEach(function(e){var n=i.getItem(e);n&&t(n.node,n)}),i},_processItems:function(e,t,i){return this.processItems(e,function(e){t(e,i)})},enableItems:function(e){return this._processItems(e,h,"x-disabled")},disableItems:function(e){return this._processItems(e,f,"x-disabled")},showItems:function(e){return this._processItems(e,h,"hide")},hideItems:function(e){return this._processItems(e,f,"hide")},_setPos:function(i,n,s,r){var o=this,a=o.rangeX,u=o.rangeY,d=i.node,f=d.offsetWidth,h=d.offsetHeight,c=i.data||{},_=c.maxHeight;if(_){var m=Math.max(h,d.scrollHeight),l=m>_;d.style.height=l?_+"px":"auto",o.fixedWidth||(d.style.width=c.width+(l?17:0)+"px"),h=d.offsetHeight}return n==e&&(n=o.x||0),s==e&&(s=o.y||0),a&&n+f>a&&(n=a-f,r&&(n=n-r.offsetWidth+3)),u&&s+h>u&&(s=u-h-1),0>n&&(n=0),0>s&&(s=0),t(d,n,s),o.x=n,o.y=s,o},_showSub:function(e,t,i){var n=this,s=n._getMenu(e),r=n._getSubMenu(t);if(r){var o=s.node,d=r.node,f=u(i),h=+a(o,"zIndex"),c=+a(d,"zIndex");h>=c&&(d.style.zIndex=h+1),n._setPos(r,f.left+i.offsetWidth-2,f.top,o)}return n.i=e,n.j=t,n},_inactive:function(e){var t=this._getItem(e);return t&&h(t.node,"x-on"),this},_hideSub:function(e,t){var i=this;if(e<=i.i&&t!=i.j){var n,s=i._menus;for(n=s.length-1;n>e;n--)i._hide(s[n]);if(e<i.i)for(n=i.i;n>e;n--){var r=i._getMenu(n);i._inactive(r.j)}}return e==i.i&&t!=i.j&&i._getSubMenu(i.j)&&i._inactive(i.j),i},_hide:function(e){if(e){var i=e.node;i.style.left!=l&&t(i,l,l)}return this},show:function(e,t){return this._setPos(this._menus[0],e,t)},hide:function(){var t=this;return t._menus.forEach(function(e){t._hide(e)}),t._active!=e&&(t._inactive(t._active),t._active=e),t},isHidden:function(){var e=this,t=e.box,i=parseFloat(t.style.left),n=parseFloat(t.style.top);return i<=-t.offsetWidth||n<=-t.offsetHeight},toggle:function(e,t){return this.isHidden()?this.show(e,t):this.hide()},destroy:function(){var e=this;return e._e0&&e._e0.off(),e._e1&&e._e1.off(),e._menus.forEach(function(e){e.node.innerHTML="",$(e.node).remove()}),Object.forEach(e,function(t){e[t]=null}),e}}),Q.ContextMenu=i}();