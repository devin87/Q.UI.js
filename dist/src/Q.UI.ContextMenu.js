//devin87@qq.com
//build:2020/03/26 15:30:47
!function(I){"use strict";var M=window.document,a=Q.fire,t=Q.extend,s=Q.makeArray,f=Q.getStyle,h=Q.offset,u=Q.hasClass,r=Q.addClass,d=Q.removeClass,w=Q.createEle,e=Q.factory,c=Q.event,i=-1e4;function _(e,t,i){t!=I&&(e.style.left=t+"px"),i!=I&&(e.style.top=i+"px")}function n(e,t){this.set(t).init(e)}e(n).extend({init:function(e){var t=this;return t.draw(e),!1!==t.autoHide&&(t._e0=c.add(M,"click",function(){t.hide()})),t},set:function(e){return t(this,e,!0),this},draw:function(e){var o=this;o._menus=[],o._items=[],o._map_menu={},o._map_item={},o.i=o.j=0,o._active=I;var t,i=o._tmp=[];for(o.drawMenu(e);t=i.shift();)o.drawMenu.apply(o,t);o._tmp=null,o.i=o.j=0;var n=o._getMenu(0).node;o.box=n;var s=[];return o._menus.forEach(function(e){e&&!e.linked&&s.push(e.node)}),o._e1&&o._e1.off(),o._e1=c.add(s,{click:function(e){var t=this,i=t._j;if(u(t,"x-disabled")||o._getSubMenu(i)&&!o.isFireAll)return!1;var n=o._getItem(i);a(n.data.click,t,e,n),a(o.onclick,t,e,n),o.hide()},mouseenter:function(e){var t=this,i=t._i,n=t._j;o._hideSub(i,n),r(t,"x-on");var s=o._getItem(n);a(s.data.mouseover,t,e,s),a(o.onmouseover,t,e,s),u(t,"x-disabled")||o._showSub(i,n,t)},mouseleave:function(e){var t=this,i=t._i,n=t._j,s=o._getSubMenu(n);u(t,"x-disabled")||!s?d(t,"x-on"):0==i&&(o._active=n);var r=o._getItem(n);a(r.data.mouseout,t,e,r),a(o.onmouseout,t,e,r)}},".x-item"),o._e2&&o._e2.off(),o._e2=c.add(s,"mousedown",c.stop),o.hide()},drawMenu:function(e,t){var i=this,n=i._menus,s=i._items,r=i._map_menu,o=i._map_item,a=!!(d=e.box),u=i.i++;if(!d){var d,f=e.className;(d=w("div","x-panel"+(f?" "+f:""))).style.width=(e.width||120)+"px"}if(n[u]={node:d,linked:a,j:t,data:e},t&&(r[t]=u),a)return i;for(var h=!1!==i.subMenu,c=0,_=e.items;c<_.length;c++){var m=_[c];if(m){var l=M.createElement("div"),v=i.j++;if(l._i=u,s[l._j=v]={node:l,i:u,j:v,data:m},m.id!=I&&(o[m.id]=v),m.split)l.className="x-split";else{l.className="x-item"+(m.disabled?" x-disabled":""),l.x=m.x!=I?m.x:"";var x=m.group,p=h&&x&&(x.box||x.items&&0<x.items.length),g=m.ico,b=m.html||'<div class="x-icon">'+(g?/^<.+>$/.test(g)?g:'<img alt="" src="'+g+'">':"")+'</div><div class="x-text"'+(m.title?' title="'+m.title+'"':"")+">"+m.text+"</div>"+(p?'<div class="arrow"></div>':"");l.innerHTML=b,p&&i._tmp.push([x,v])}d.appendChild(l)}}return Q.body.appendChild(d),i},_getMenu:function(e){return this._menus[e]},_getSubMenu:function(e){var t=this._map_menu[e];return t!=I?this._getMenu(t):I},_getItem:function(e){return this._items[e]},getItem:function(e){var t=this._map_item[e];return t!=I?this._items[t]:I},setItemText:function(e,t){var i=this.getItem(e);if(i){i.data.text=t;var n=i.node.childNodes[1];n&&(n.innerHTML=t)}},processItems:function(e,i){var n=this;return s(e).forEach(function(e){var t=n.getItem(e);t&&i(t.node,t)}),n},_processItems:function(e,t,i){return this.processItems(e,function(e){t(e,i)})},enableItems:function(e){return this._processItems(e,d,"x-disabled")},disableItems:function(e){return this._processItems(e,r,"x-disabled")},showItems:function(e){return this._processItems(e,d,"hide")},hideItems:function(e){return this._processItems(e,r,"hide")},_setPos:function(e,t,i,n){var s=this,r=s.rangeX,o=s.rangeY,a=e.node,u=a.offsetWidth,d=a.offsetHeight,f=e.data||{},h=f.maxHeight;if(h){var c=h<Math.max(d,a.scrollHeight);a.style.height=c?h+"px":"auto",s.fixedWidth||(a.style.width=f.width+(c?17:0)+"px"),d=a.offsetHeight}return t==I&&(t=s.x||0),i==I&&(i=s.y||0),r&&r<t+u&&(t=r-u,n&&(t=t-n.offsetWidth+3)),o&&o<i+d&&(i=o-d-1),t<0&&(t=0),i<0&&(i=0),_(a,t,i),s.x=t,s.y=i,s},_showSub:function(e,t,i){var n=this,s=n._getMenu(e),r=n._getSubMenu(t);if(r){var o=s.node,a=r.node,u=h(i),d=+f(o,"zIndex");+f(a,"zIndex")<=d&&(a.style.zIndex=1+d),n._setPos(r,u.left+i.offsetWidth-2,u.top,o)}return n.i=e,n.j=t,n},_inactive:function(e){var t=this._getItem(e);return t&&d(t.node,"x-on"),this},_hideSub:function(e,t){var i=this;if(e<=i.i&&t!=i.j){var n,s=i._menus;for(n=s.length-1;e<n;n--)i._hide(s[n]);if(e<i.i)for(n=i.i;e<n;n--){var r=i._getMenu(n);i._inactive(r.j)}}return e==i.i&&t!=i.j&&i._getSubMenu(i.j)&&i._inactive(i.j),i},_hide:function(e){if(e){var t=e.node;t.style.left!=i&&_(t,i,i)}return this},show:function(e,t){return this._setPos(this._menus[0],e,t)},hide:function(){var t=this;return t._menus.forEach(function(e){t._hide(e)}),t._active!=I&&(t._inactive(t._active),t._active=I),t},isHidden:function(){var e=this.box,t=parseFloat(e.style.left),i=parseFloat(e.style.top);return t<=-e.offsetWidth||i<=-e.offsetHeight},toggle:function(e,t){return this.isHidden()?this.show(e,t):this.hide()},destroy:function(){var t=this;return t._e0&&t._e0.off(),t._e1&&t._e1.off(),t._menus.forEach(function(e){e.node.innerHTML="",$(e.node).remove()}),Object.forEach(t,function(e){t[e]=null}),t}}),Q.ContextMenu=n}();