//devin87@qq.com
//build:2016/04/05 17:15:18
!function(t){"use strict";function e(t){var e=M("div","x-mask");Q.body.appendChild(e),F&&(e.style.height=q.getScrollHeight()+"px"),this.box=e,this.set(y(t||{},G))}function i(){return J?(J.show(),J):J=new e}function o(t,e){y(G,t,!0),e&&J&&J.reset(t)}function n(t){for(var e=[],i=t||f;i.top!=i;){var o=i.parent;e.push(o),i=o}return e}function s(t){var e=this;g(t,e),e._apis=[],e.start()}function r(t,e){return new s(function(){1!=t.nodeType?(e=t,t=e.ele):(e=e||{},e.ele=t);var i,o,n,s,r,a,c,u,d=this,l=e.range||{x:0,y:0},f=!!e.shadow,h=t.offsetWidth,x=t.offsetHeight,p=t;f&&(Z||(Z=M("div","x-drag-shadow"),Q.body.appendChild(Z)),p=Z),d.ops=e,d.doDown=function(e){n=e.clientX,s=e.clientY;var r=f?$(t).offset():$(t).position();i=r.left,o=r.top,f&&Object.forEach({left:i,top:o,width:h,height:x},function(t,e){p.style[t]=e+"px"})},d.doMove=function(t){if(D(p),c){r=t.clientX-n;var e=i+r;l&&(e<l.x?e=l.x:l.w&&e+h>l.x+l.w&&(e=l.x+l.w-h)),p.style.left=e+"px"}if(u){a=t.clientY-s;var d=o+a;l&&(d<l.y?d=l.y:l.h&&d+x>l.y+l.h&&(d=l.y+l.h-x)),p.style.top=d+"px"}},f&&(d.doUp=function(){W(p),t.style.left=t.offsetLeft+r+"px",t.style.top=t.offsetTop+a+"px"}),d.setLock=function(t,e){return c=t,u=e,d.pause(!t&&!e)},d.setRange=function(t,e,i,o){return l=v(t)?t:{x:t,y:e,w:i,h:o},d},d.setLock(e.isX!==!1,e.isY!==!1)})}function a(t){this._es=[],g(t,this)}function c(t){return t=t||{},new a(function(){var o=this,n=t.width,s=t.height,a=t.maxHeight,c=t.className;o.callback=t.callback;var u='<div class="x-head"><h2 class="x-title">'+(t.title||"弹出框")+'</h2><a class="x-close" title="点击关闭">X</a></div><div class="x-main"><div class="x-view">'+(t.html||"")+"</div></div>";F&&(u+='<iframe class="x-ie-fix" style="position: absolute;top:0;left:0;z-index:-1;" scrolling="no" frameborder="0"></iframe>');var d=M("div","x-box"+(c?" "+c:""),u);Q.body.appendChild(d);var l=t.zIndex||0;V>P&&(l=Math.max(l,V)),l&&(d.style.zIndex=l);var f=H(d),v=z(f);p(n)&&E(d,n),a&&(p(s)&&s>a&&(s=a),d.offsetHeight>a&&(s=a,N(d,"x-box-auto"))),p(s)&&s>50&&I(v,s-f.offsetHeight-20),f.offsetWidth<10&&E(f,d.offsetWidth),t.mask&&(o.mbox="new"==t.mask?new e:i());var x=t.close||"hide",b=o.getEventCallback(x);o.bind(".x-close","click",x),t.esc!==!1&&o.bind(h,"keyup",function(t){27==t.keyCode&&b()});var y=t.time;m(y)&&w(b,y),o.box=d,g(t.init,o,d,t),t.drag!==!1&&(o.dr=r(d,{target:f,center:t.center!==!1,shadow:t.shadow!==!1,autoMask:!0,onCheck:function(t){var e=t.target;return e&&"x-close"!=e.className}})),$(".x-ie-fix",d).width(d.offsetWidth-2).height(d.offsetHeight-2),o.setTitle=function(t){$(".x-title",f).html(t)}})}function u(t){t.width||(t.width=320);var e=t.width;if(t.icon||t.iconHtml){var i='<div class="fl x-ico">'+(t.iconHtml||'<img alt="" src="'+t.icon+'"/>')+'</div><div class="fl x-dialog"'+(p(e)?' style="width:'+(e-60)+'px;"':"")+">"+t.html+'</div><div class="clear"></div>';t.html=i;var o=t.init;t.init=function(t,e){var i=this,n=i.get(".x-view").offsetWidth-i.get(".x-ico").offsetWidth;$(".x-dialog",t).width(n),g(o,i,t,e)}}else t.html='<div class="x-dialog">'+t.html+"</div>";return t.bottom&&(t.html+=t.bottom),t.close||(t.close="remove"),c(t)}function d(t,e){var i="inline-block w-button w-"+(e||"dark"),o='<div class="x-bottom"><div class="'+i+' x-submit">确定</div>'+(2==t?'<div class="'+i+' x-cancel">取消</div>':"")+"</div>";return o}function l(t,e,i,o){return"object"==typeof i&&(o=i,i=o),o=y({},o),x(i)&&(o.callback=i),o.title||(o.title=t),o.html=e,o}var f=Q.G,h=f.document,v=Q.isObject,x=Q.isFunc,p=Q.isUNum,m=Q.isUInt,b=Q.def,g=Q.fire,w=Q.async,y=Q.extend,k=Q.makeArray,_=Q.getStyle,C=Q.setStyle,H=Q.getFirst,z=Q.getNext,E=Q.width,I=Q.height,M=Q.createEle,S=Q.removeEle,D=Q.show,W=Q.hide,B=Q.isHidden,N=Q.addClass,U=Q.setCssIfNot,X=Q.setCenter,j=Q.setInputError,L=Q.setInputDefault,T=Q.clearSelection,O=Q.query,R=Q.factory,Y=Q.ie,F=7>Y,q=Q.view,A=Q.event,G={color:"#999",opacity:.3};R(e).extend({opacity:function(t){return this.set({opacity:t})},set:function(e){var i=this.box;return Object.forEach(e,function(e,o){o!==t&&C(i,"color"!=e?e:"backgroundColor",o)}),this},show:function(){return this.removed&&(Q.body.appendChild(this.box),this.removed=!1),D(this.box),this},hide:function(){return W(this.box),this},remove:function(){return S(this.box),this.removed=!0,this}});var J,K,P=1e3,V=P;R(s).extend({start:function(){var t=this,i=t.ops,o=i.scope||f,s=o.document,r=i.ele,a=i.target||r,c=i.autoIndex!==!1,u=!!i.autoMask,d=i.autoCss!==!1,l=i.autoCursor!==!1,h=1==r.nodeType?+_(r,"z-index"):0,v=t.doDown,p=t.doMove,m=t.doUp,b=i.onCheck,y=i.onDown,Q=i.onMove,k=i.onUp,C=n(o),H=!!r.setCapture,z=!H&&C.length>0;h>=V&&(V=h+1),d&&U(r,"position","absolute"),d&&l&&U(a,"cursor","move"),i.center&&(X(r),t._api_resize=A.add(o,"resize",function(){X(r)}));var E=function(i){if(!x(b)||b.call(t,i)!==!1){if(c){var n=+_(r,"z-index")||0;V>n&&(V++,r.style.zIndex=V)}t._unbind(),H?(r.setCapture(),t._bind(r,"losecapture",M)):t._bind(o,"blur",M),t._bind(s,{mousemove:I,mouseup:M}),z&&t._bind(C,"mouseup",M),u&&(K||(K=new e({color:null,opacity:null,zIndex:999999})),F&&K.set({height:q.getScrollHeight()})),w(T,20),g(v,t,i),g(y,t,i)}},I=function(e){t._pause||(g(p,t,e),g(Q,t,e))},M=function(e){t._unbind(),H&&r.releaseCapture(),u&&K&&(K.remove(),K=null),T(),g(m,t,e),g(k,t,e)};return t._up=M,t._api=A.add(a,"mousedown",E),t},_bind:function(){this._apis.push(A.add.apply(A,arguments))},_unbind:function(){var t=this._apis;t.length>0&&(t.forEach(function(t){t.off()}),this._apis=[])},pause:function(t){var e=this;return e._pause=t,e._up&&e._up(),e},stop:function(){var t=this,e=t._api;return t._unbind(),e&&(e.off(),t._api=null),t},destroy:function(){var t=this,e=t._api_resize;return t.stop(),e&&(e.off(),t._api_resize=null),t}});var Z;$.fn.extend({drag:function(t){return this.each(function(e,i){r(i,t)})}}),R(a).extend({find:function(t,e){return"string"==typeof t?O(t,e||this.box):k(t)},get:function(t,e){return this.find(t,e)[0]},fire:function(){return g(this.callback,this,this.data),this},getEventCallback:function(t,e){var i=this;return"hide"==t?function(){i.data=e,i.hide()}:"remove"==t?function(){i.data=e,i.remove()}:t},bind:function(t,e,i,o){var n=this;return n._es.push(A.add(n.find(t),e,n.getEventCallback(i,o))),n},on:function(t,e,i,o){var n=this;return n._es.push(A.add(n.box,t,e,n.getEventCallback(i,o))),n},show:function(){var t=this;return t.onShow&&t.onShow(),D(t.box),t.mbox&&t.mbox.show(),t},hide:function(){var t=this;return W(t.box),t.mbox&&t.mbox.hide(),t.onHide&&t.onHide(),t.fire()},toggle:function(){return B(this.box)?this.show():this.hide()},remove:function(){var t=this;if(t.box)return S(t.box),t.mbox&&t.mbox.remove(),t.dr&&t.dr.destroy(),t._es.forEach(function(t){t.off()}),t.box=t.mbox=t.dr=null,t.onRemove&&t.onRemove(),t.fire()}}),a.alias("remove","destroy");var tt={createDialogBox:u,alert:function(t,e,i){return i=l("提示信息",t,e,i),i.iconHtml='<div class="ico x-alert"></div>',u(i)},confirm:function(t,e,i){i=l("确认信息",t,e,i),i.bottom||(i.bottom=d(2)),i.mask=i.mask!==!1;var o=u(i);return o.bind(".x-submit","click","remove",!0).bind(".x-cancel","click","remove",!1)},prompt:function(e,i,o){o=l("输入信息",t,i,o);var n='<div class="x-text">'+e+'</div><div class="x-input"><input type="'+(o.pwd?"password":"text")+'" /></div>';o.html=n,o.bottom||(o.bottom=d(2));var s=u(o),r=s.get(".x-input>input");r.focus(),r.value=b(o.value,"");var a=function(){var t=g(i,r,r.value);t!==!1?s.remove():j(r)};return s.bind(r,"keyup",function(t){13==t.keyCode?a():L(this)}),s.bind(".x-submit","click",a).bind(".x-cancel","click","remove")},bottom:d,showLoading:function(t){return t=y({},t),t.title||(t.title="加载数据"),t.html||(t.html="正在加载数据,请稍后…"),t.iconHtml='<div class="ico x-loading"></div>',u(t)}};y(Q,tt),y(Q,{getMaskBox:i,maskSetup:o,setDrag:r,MaskBox:e,DragX:s,Box:a,WinBox:c})}();