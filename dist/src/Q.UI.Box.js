//devin87@qq.com
//build:2015/07/23 11:17:31
!function(t){"use strict";function e(t){var e=z("div","x-mask");Q.body.appendChild(e),R&&(e.style.height=Y.getScrollHeight()+"px"),this.box=e,this.set(y(t||{},q))}function i(){return G?(G.show(),G):G=new e}function o(t,e){y(q,t,!0),e&&G&&G.reset(t)}function n(t){for(var e=[],i=t||d;i.top!=i;){var o=i.parent;e.push(o),i=o}return e}function s(t){var e=this;b(t,e),e._apis=[],e.start()}function a(t,e){return new s(function(){1!=t.nodeType?(e=t,t=e.ele):(e=e||{},e.ele=t);var i,o,n,s,a=this,r=e.range||{x:0,y:0},c=e.shadow!==!1,l=t.offsetWidth,u=t.offsetHeight,d=t;c&&(P||(P=z("div","x-drag-shadow"),Q.body.appendChild(P)),d=P),a.ops=e,a.doDown=function(e){i=e.clientX-t.offsetLeft,o=e.clientY-t.offsetTop,c&&Object.forEach(_(t),function(t,e){k(d,t,e)})},a.doMove=function(t){if(j(d),n){var e=t.clientX-i;r&&(e<r.x?e=r.x:r.w&&e+l>r.x+r.w&&(e=r.x+r.w-l)),d.style.left=e+"px"}if(s){var a=t.clientY-o;r&&(a<r.y?a=r.y:r.h&&a+u>r.y+r.h&&(a=r.y+r.h-u)),d.style.top=a+"px"}},c&&(a.doUp=function(){W(d)||(M(d),t.style.left=d.style.left,t.style.top=d.style.top)}),a.setLock=function(t,e){return n=t,s=e,a.pause(!t&&!e)},a.setRange=function(t,e,i,o){return r=h(t)?t:{x:t,y:e,w:i,h:o},a},a.setLock(e.isX!==!1,e.isY!==!1)})}function r(t){b(t,this)}function c(t){return t=t||{},new r(function(){var e=this,o=t.width,n=t.height,s=t.maxHeight,r=t.className;e.callback=t.callback;var c='<div class="x-head"><h2 class="x-title">'+(t.title||"弹出框")+'</h2><a class="x-close" title="点击关闭">X</a></div><div class="x-main"><div class="x-view">'+(t.html||"")+"</div></div>";R&&(c+='<iframe class="x-ie-fix" style="position: absolute;top:0;left:0;z-index:-1;" scrolling="no" frameborder="0"></iframe>');var l=z("div","x-box"+(r?" "+r:""),c);Q.body.appendChild(l);var u=t.zIndex||0;K>J&&(u=Math.max(u,K)),u&&(l.style.zIndex=u);var d=C(l),h=H(d);x(o)&&E(l,o),s&&(x(n)&&n>s&&(n=s),l.offsetHeight>s&&(n=s,N(l,"x-box-auto"))),x(n)&&n>50&&I(h,n-d.offsetHeight-20),d.offsetWidth<10&&E(d,l.offsetWidth),t.mask&&(e.mbox=i());var v=t.close||"hide",p=e.getEventCallback(v);e.on(".x-close","click",v),t.esc!==!1&&F.add(f,"keyup",function(t){27==t.keyCode&&p()});var y=t.time;m(y)&&g(p,y),e.box=l,b(t.init,e,l,t),t.drag!==!1&&a(l,{target:d,center:t.center!==!1,onCheck:function(t){var e=t.target;return e&&"x-close"!=e.className}}),$(".x-ie-fix",l).width(l.offsetWidth-2).height(l.offsetHeight-2),e.setTitle=function(t){$(".x-title",d).html(t)}})}function l(t){t.width||(t.width=320);var e=t.width;if(t.icon||t.iconHtml){var i='<div class="fl x-ico">'+(t.iconHtml||'<img alt="" src="'+t.icon+'"/>')+'</div><div class="fl x-dialog"'+(x(e)?' style="width:'+(e-60)+'px;"':"")+">"+t.html+'</div><div class="clear"></div>';t.html=i;var o=t.init;t.init=function(t,e){var i=this,n=i.get(".x-view").offsetWidth-i.get(".x-ico").offsetWidth;$(".x-dialog",t).width(n),b(o,i,t,e)}}else t.html='<div class="x-dialog">'+t.html+"</div>";return t.bottom&&(t.html+=t.bottom),t.close||(t.close="remove"),c(t)}function u(t,e){var i="inline-block w-button w-"+(e||"dark"),o='<div class="x-bottom"><div class="'+i+' x-submit">确定</div>'+(2==t?'<div class="'+i+' x-cancel">取消</div>':"")+"</div>";return o}var d=Q.G,f=d.document,h=Q.isObject,v=Q.isFunc,x=Q.isUNum,m=Q.isUInt,p=Q.def,b=Q.fire,g=Q.async,y=Q.extend,w=Q.getStyle,k=Q.setStyle,_=Q.offset,C=Q.getFirst,H=Q.getNext,E=Q.width,I=Q.height,z=Q.createEle,S=Q.removeEle,j=Q.show,M=Q.hide,W=Q.isHidden,D=Q.toggle,N=Q.addClass,U=Q.setCssIfNot,X=Q.setCenter,B=Q.query,L=Q.clearSelection,O=Q.factory,T=Q.ie,R=7>T,Y=Q.view,F=Q.event,q={color:"#999",opacity:.3};O(e).extend({opacity:function(t){return this.set({opacity:t})},set:function(e){var i=this.box;return Object.forEach(e,function(e,o){o!==t&&k(i,"color"!=e?e:"backgroundColor",o)}),this},show:function(){return this.removed&&(Q.body.appendChild(this.box),this.removed=!1),j(this.box),this},hide:function(){return M(this.box),this},remove:function(){return S(this.box),this.removed=!0,this}});var G,A,J=1e3,K=J;O(s).extend({start:function(){var t=this,i=t.ops,o=i.scope||d,s=o.document,a=i.ele,r=i.target||a,c=i.autoIndex!==!1,l=i.autoMask!==!1,u=1==a.nodeType?+w(a,"z-index"):0,f=t.doDown,h=t.doMove,x=t.doUp,m=i.onCheck,p=i.onDown,y=i.onMove,Q=i.onUp,k=n(o),_=!!a.setCapture,C=!_&&k.length>0;u>=K&&(K=u+1),U(a,"position","absolute"),U(r,"cursor","move"),i.center&&(X(a),F.add(o,"resize",function(){X(a)}));var H=function(i){if(!v(m)||m.call(t,i)!==!1){if(c){var n=+w(a,"z-index")||0;K>n&&(K++,a.style.zIndex=K)}t._unbind(),_?(a.setCapture(),t._bind(a,"losecapture",I)):t._bind(o,"blur",I),t._bind(s,{mousemove:E,mouseup:I}),C&&t._bind(k,"mouseup",I),l&&(A||(A=new e({color:null,opacity:null,zIndex:999999})),R&&A.set({height:Y.getScrollHeight()})),g(L,20),b(f,t,i),b(p,t,i)}},E=function(e){t._pause||(b(h,t,e),b(y,t,e))},I=function(e){t._unbind(),_&&a.releaseCapture(),l&&A&&(A.remove(),A=null),L(),b(x,t,e),b(Q,t,e)};t._up=I,t._api=F.add(r,"mousedown",H)},_bind:function(){this._apis.push(F.add.apply(F,arguments))},_unbind:function(){var t=this._apis;t.length>0&&(t.forEach(function(t){t.off()}),this._apis=[])},pause:function(t){this._pause=t,this._up&&this._up()},stop:function(){var t=this,e=t._api;t._unbind(),e&&(e.off(),t._api=null)}});var P;$.fn.extend({drag:function(t){return this.each(function(e,i){a(i,t)})}}),O(r).extend({find:function(t,e){return B(t,e||this.box)},get:function(t,e){return this.find(t,e)[0]},fire:function(){return b(this.callback,this,this.data),this},getEventCallback:function(t,e){var i=this;return"hide"==t?function(){i.data=e,i.hide()}:"remove"==t?function(){i.data=e,i.remove()}:t},on:function(t,e,i,o){var n=this,s=n.find(t);return h(e)?(o=i,Object.forEach(e,function(t,e){F.add(s,t,n.getEventCallback(e,o))})):F.add(s,e,n.getEventCallback(i,o)),n},show:function(){var t=this;return t.onShow&&t.onShow(),j(t.box),t.mbox&&t.mbox.show(),t},hide:function(){var t=this;return M(t.box),t.mbox&&t.mbox.hide(),t.onHide&&t.onHide(),t.fire()},toggle:function(){return D(this.box),this},remove:function(){var t=this;if(t.box)return S(t.box),t.mbox&&t.mbox.remove(),t.box=t.mbox=null,t.onRemove&&t.onRemove(),t.fire()}});var V={create:l,alert:function(t,e,i){var i=i||{};return v(e)?i.callback=e:"object"==typeof e&&(i=e),i.title||(i.title="提示信息"),i.iconHtml='<div class="ico x-alert"></div>',i.html=t,l(i)},confirm:function(t,e,i){var i=i||{};v(e)?i.callback=e:"object"==typeof e&&(i=e),i.title||(i.title="确认信息"),i.html=t,i.bottom||(i.bottom=u(2)),i.mask=i.mask!==!1;var o=l(i);return o.on(".x-submit","click","remove",!0).on(".x-cancel","click","remove",!1),o},prompt:function(t,e,i){var i=i||{};"object"==typeof e&&(i=e),i.title||(i.title="输入信息"),i.html='<div class="x-text">'+t+'</div><div class="x-input"><input type="'+(i.pwd?"password":"text")+'" /></div>',i.width||(i.width=320),i.bottom||(i.bottom=u(2));var o=l(i),n=o.get(".x-input>input");n.focus(),n.value=p(i.value,"");var s=function(){var t=b(e,n,n.value);t!==!1?o.remove():setInputError(n)};return o.on(n,"keyup",function(t){13==t.keyCode?s():setInputDefault(this)}),o.on(".x-submit","click",s).on(".x-cancel","click","remove"),o},bottom:u,showLoading:function(t){return t=t||{html:"正在加载数据,请稍后…"},t.iconHtml='<div class="ico x-loading"></div>',t.title||(t.title="加载数据"),l(t)}};y(Q,V),y(Q,{getMaskBox:i,maskSetup:o,setDrag:a,MaskBox:e,DragX:s,Box:r,WinBox:c})}();