//devin87@qq.com
//build:2018/06/13 11:37:29
!function(t){"use strict";var r=window.document,e=Q.isFunc,o=Q.extend,i=Q.getFirst,n=Q.getNext,l=Q.getLast,s=Q.createEle,a=Q.factory,c=Q.event,f={cubic_color:"立方色",series_color:"连续色调",gray_color:"灰度等级"};function u(r,e,o){e!=t&&(r.style.left=e+"px"),o!=t&&(r.style.top=o+"px")}function d(t,r){return"#"+(r?Math.round(255*r).toString(16):"")+("00000"+t.toString(16)).slice(-6)}function h(t,r,e,o){return d(65536*t+256*r+1*e,o)}function v(t){var r=[];if("number"==typeof t&&(t=d(t)),0==t.indexOf("#")){var e=t.length;return 3!=e&&4!=e||(t="#"+t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2),4==e&&(t+=t.charAt(3)+t.charAt(3))),9==e&&(r[3]=Math.round(100*parseInt(t.substr(1,2),16)/255)/100,t="#"+t.slice(3)),7==t.length&&(r[0]=parseInt(t.substr(1,2),16),r[1]=parseInt(t.substr(3,2),16),r[2]=parseInt(t.substr(5,2),16)),r}var o=(t=t.replace(/\s+/g,"")).indexOf("(");return-1!=o&&(r=t.slice(o+1,-1).split(",")),r}function p(r){var e=v(r);return e.length<=0?r:h.apply(t,e.slice(0,3))}Q.parseColor=v,Q.toHex=p,Q.toAHex=function(r){var e=v(r);return e.length<=0?r:h.apply(t,e)},Q.toRGB=function(t){var r=v(t);return r.length<=0?t:"rgb("+r.slice(0,3).join(",")+")"},Q.toRGBA=function(t){var r=v(t);return r.length<=0?t:"rgba("+r.join(",")+")"};var b=["#000000","#333333","#666666","#999999","#cccccc","#ffffff","#ff0000","#00ff00","#0000ff","#ffff00","#00ffff","#ff00ff"];function x(t){var r=this;r.row=12,r.col=21,r.set(t).init()}a(x).extend({init:function(){var t=this,e='<div class="xp-title"><div class="xp-preview"></div><div class="xp-val"></div><div class="xp-type"><select><option value="Cube" selected="selected">'+f.cubic_color+'</option><option value="Series">'+f.series_color+'</option><option value="Gray">'+f.gray_color+'</option></select></div></div><div class="xp-table"><table>'+("<tr>"+"<td></td>".repeat(t.col)+"</tr>").repeat(t.row)+"</table></div>",o=s("div","x-picker",e),a=i(o),u=i(a),d=n(u),h=l(a),v=l(o),p=i(v);return Q.body.appendChild(o),t.box=o,t.table=p,t.boxPreview=u,t.boxValue=d,c.add(i(h),"change",function(){t["draw"+this.value+"Color"]()}),c.add(p,{mouseover:function(r){t.setPreview(this.style.backgroundColor)},click:function(r){var e=this.style.backgroundColor;t.fire(e).hide()}},"td"),c.add(o,"click",c.stop),c.add(r,"click",function(r){t.hide()}),t.drawCubeColor().hide()},set:function(t){return o(this,t,!0),this.setPreview((t||{}).color)},fire:function(t){var r=this;return e(r.callback)&&r.callback.call(r,r.isHex?p(t):t),r},setPreview:function(t){return t&&(this.boxPreview.style.backgroundColor=t,this.boxValue.innerHTML=p(t).toUpperCase()),this},fillColor:function(t,r,e){return this.table.rows[t].cells[r].style.backgroundColor=e,this},drawLeftColor:function(){for(var t=this.row,r=0;r<t;r++)this.fillColor(r,0,"#000").fillColor(r,1,b[r]).fillColor(r,2,"#000");return this},drawCubeColor:function(){var t,r=this,e=r.row,o=r.col,i=0;r.drawLeftColor();for(var n=0;n<e;n++){t=i=n>5?10027008+51*(n-6):0+51*n;for(var l=3;l<o;l++)r.fillColor(n,l,d(t)),t+=13056,(l-2)%6==0&&(t=i+=3342336)}return r},drawSeriesColor:function(){var t,r=this,e=r.row,o=r.col,i=13434879,n=1;r.drawLeftColor();for(var l=0;l<e;l++){t=i=l>5?16711935+13056*(l-6):13434879-13056*l,n=1;for(var s=3;s<o;s++)r.fillColor(l,s,d(t)),t-=51*n,(s-2)%6==0&&(t=(i-=6684672)-((n*=-1)>0?0:255))}return r},drawGrayColor:function(){for(var t=this.row,r=this.col,e=16777215,o=0;o<t;o++)for(var i=0;i<r;i++)this.fillColor(o,i,d(e)),e<=0?e=0:e-=65793;return this},show:function(r,e){var o=this;return r==t?r=o.x:o.x=r,e==t?e=o.y:o.y=e,u(o.box,r,e),o},hide:function(){return u(this.box,-1e4,-1e4),this},isHidden:function(){var t=this.box,r=parseFloat(t.style.left),e=parseFloat(t.style.top);return r<=-t.offsetWidth||e<=-t.offsetHeight},toggle:function(t,r){return this.isHidden()?this.show(t,r):this.hide()}}),x.setLang=function(t){o(f,t,!0)},Q.ColorPicker=x}();