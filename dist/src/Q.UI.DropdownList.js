//devin87@qq.com
//build:2017/02/20 15:26:28
!function(e){"use strict";function t(e){e=e||{};var t=this;t.box=e.box,t.items=e.items||[],t.multiple=e.multiple,t.canInput=e.canInput,t.textProp=e.textProp||"text",t.value=e.value,t.index=e.index||0,t.ops=e}var i=window.document,s=Q.def,n=Q.fire,l=Q.isObject,a=Q.getFirst,d=Q.getLast,r=Q.width,o=r,u=Q.hasClass,c=Q.addClass,x=Q.removeClass,h=Q.createEle,v=Q.factory,p=Q.ie,f=Q.event;v(t).extend({init:function(){var e=this,t=e.ops,s=e.box,l=!e.multiple,r=e.canInput,x=(l?'<div class="x-sel-tag">'+(r?'<input type="text" class="x-sel-text" />':'<div class="x-sel-text"></div>')+'<div class="x-sel-arrow"><div class="arrow arrow-down"></div></div></div>':"")+'<div class="x-panel x-sel-list'+(l?"":" x-sel-multiple")+'"></div>';c(s,"x-sel"),s.innerHTML=x;var h,v,m,w=d(s);o(w,t.width||s.offsetWidth-2),l&&(h=a(s),v=a(h),m=d(h),e.elText=v,e.elArrow=m),e.elList=w;var g;return l?(t.autoHide!==!1&&f.add(i,"mousedown",function(){e.hide()}),f.add(r?m:s,"mousedown",function(t){return e.toggle(),!1}),g={mousedown:f.stop,mouseup:function(t){var i=this.x,s=e.items[i];n(e.onclick,e,s,i),s.disabled||(e.hide(),i!=e.index&&e.select(i))},mouseenter:function(){var t=this.x,i=e.items[t];i.disabled||e.active(t)}}):(e.selectedItems=[],e.seletedMap={},g={mousedown:function(t){var i=this;if(!u(i,"x-disabled")){var s=this.x,n=e.selectedItems[0],l=t.shiftKey,a=t.ctrlKey;if(!l&&a||e.clearSelect(),l){var d=n?n.index:s,r=s;d>r&&(r=d,d=s);for(var o=d;r>=o;o++)e.active(o)}else a&&e.seletedMap[s]?e.inactive(s):e.select(s)}}},10>p&&(g.selectstart=f.stop)),f.add(w,g,".x-item"),e.draw()},draw:function(){var e=this,t=e.ops,i=e.items,s=e.elList,n=t.hasTitle,l=t.maxHeight,a={};if(s.innerHTML="",i.forEach(function(e,t){e.index=t,a[e.value]=e;var i=e.text||"",l=h("div","x-item"+(e.group?" x-sel-group":e.disabled?" x-disabled":""),i);n&&(l.title=e.title||i.toText()),l.x=t,e.node=l,s.appendChild(l)}),e.map=a,l){var d=s.offsetHeight;d>l&&(s.style.height=l)}var r=e.value,o=e.index;if(r){var u=e.find(r);u&&(o=u.index)}return e.select(o),e.multiple?e:e.hide()},add:function(e,t,i){return this.items.push(l(e)?e:{text:e,value:t,title:i}),this},find:function(e){return this.map[e]},clearSelect:function(){var e=this,t=function(e){e.node&&x(e.node,"selected")};return e.multiple?(e.selectedItems.forEach(t),e.selectedItems=[],e.seletedMap={}):t({node:e._el}),e},active:function(e){var t=this,i=t.items[e];if(!i)return t;var s,n=i.node;return t.multiple?i.disabled||t.seletedMap[e]||(t.selectedItems.push(i),t.seletedMap[e]=!0,s=!0):(t.clearSelect(),s=!0,t._el=n),s&&c(n,"selected"),this},inactive:function(t){var i=this,s=i.items[t];return i.multiple&&(i.selectedItems=i.selectedItems.filter(function(e){return e.index!=t}),i.seletedMap[t]=e),x(s.node,"selected"),i},select:function(e,t){var i=this,l=i.items,a=l[e];return a?(i.text=s(a.text,""),i.value=s(a.value,""),i.elText&&(i.elText[i.canInput?"value":"innerHTML"]=i[i.textProp]),i.active(e),t||e==i.index||n(i.onchange,i,a,e),i.index=e,i):i},show:function(){return this.elList.style.display="",this.select(this.index)},hide:function(){return this.elList.style.display="none",this},toggle:function(){return"none"==this.elList.style.display?this.show():this.hide()},getText:function(){return this.canInput?this.elText.value:this.text}}),Q.DropdownList=t}();